#coding=gbk
import os,shutil
import matplotlib
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
import talib
import datetime, time
import xgboost as xgb
from xgboost import XGBClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score
import math
from dateutil.relativedelta import relativedelta
from sklearn.model_selection import GridSearchCV

rootdir = "C:/StockAnalysis/"
os.chdir(rootdir)
pd.set_option('display.max_columns', None)

def listDiff(list1, list2):
    ret1 = [i for i in list1 if i not in list2]
    ret2 = [i for i in list2 if i not in list1]
    return ret1 + ret2

def getMarketCode(strCode):
    strCode = strCode[:-3]
    if (strCode[0:1] == "6"):
        return "SH#" + strCode + ".txt"
    else:
        return "SZ#" + strCode + ".txt"

def mycopyfile(srcfile,dstfile):
    if not os.path.isfile(srcfile):
        print (srcfile + " not exist!")
    else:
        fpath,fname=os.path.split(dstfile)    #分离文件名和路径
        if not os.path.exists(fpath):
            os.makedirs(fpath)                #创建路径
        shutil.copyfile(srcfile,dstfile)      #复制文件
        print ("copy " + srcfile + " -> " + dstfile)
        
def convertCode(strCode):
    strCode = strCode[:-5]
    if (strCode[0:1] == "6"):
        return strCode + ".SH"
    else:
        return strCode + ".SZ"
    

hs300 = ['000001.XSHE', '000002.XSHE', '000063.XSHE', '000069.XSHE', '000100.XSHE', '000157.XSHE', '000166.XSHE', '000333.XSHE', '000338.XSHE', '000402.XSHE', '000408.XSHE', '000413.XSHE', '000415.XSHE', '000423.XSHE', '000425.XSHE', '000503.XSHE', '000538.XSHE', '000553.XSHE', '000568.XSHE', '000625.XSHE', '000627.XSHE', '000630.XSHE', '000651.XSHE', '000661.XSHE', '000671.XSHE', '000703.XSHE', '000709.XSHE', '000725.XSHE', '000728.XSHE', '000768.XSHE', '000776.XSHE', '000783.XSHE', '000786.XSHE', '000792.XSHE', '000826.XSHE', '000839.XSHE', '000858.XSHE', '000876.XSHE', '000895.XSHE', '000898.XSHE', '000938.XSHE', '000959.XSHE', '000961.XSHE', '000963.XSHE', '000983.XSHE', '001965.XSHE', '001979.XSHE', '002001.XSHE', '002007.XSHE', '002008.XSHE', '002024.XSHE', '002027.XSHE', '002032.XSHE', '002044.XSHE', '002050.XSHE', '002065.XSHE', '002081.XSHE', '002085.XSHE', '002120.XSHE', '002142.XSHE', '002146.XSHE', '002153.XSHE', '002179.XSHE', '002202.XSHE', '002230.XSHE', '002236.XSHE', '002241.XSHE', '002252.XSHE', '002271.XSHE', '002294.XSHE', '002304.XSHE', '002310.XSHE', '002311.XSHE', '002352.XSHE', '002411.XSHE', '002415.XSHE', '002422.XSHE', '002450.XSHE', '002456.XSHE', '002460.XSHE', '002466.XSHE', '002468.XSHE', '002475.XSHE', '002493.XSHE', '002508.XSHE', '002555.XSHE', '002558.XSHE', '002572.XSHE', '002594.XSHE', '002601.XSHE', '002602.XSHE', '002624.XSHE', '002625.XSHE', '002673.XSHE', '002714.XSHE', '002736.XSHE', '002773.XSHE', '002797.XSHE', '002925.XSHE', '300003.XSHE', '300015.XSHE', '300017.XSHE', '300024.XSHE', '300033.XSHE', '300059.XSHE', '300070.XSHE', '300072.XSHE', '300122.XSHE', '300124.XSHE', '300136.XSHE', '300142.XSHE', '300144.XSHE', '300251.XSHE', '300296.XSHE', '300408.XSHE', '300433.XSHE', '600000.XSHG', '600004.XSHG', '600009.XSHG', '600010.XSHG', '600011.XSHG', '600015.XSHG', '600016.XSHG', '600018.XSHG', '600019.XSHG', '600023.XSHG', '600025.XSHG', '600027.XSHG', '600028.XSHG', '600029.XSHG', '600030.XSHG', '600031.XSHG', '600036.XSHG', '600038.XSHG', '600048.XSHG', '600050.XSHG', '600061.XSHG', '600066.XSHG', '600068.XSHG', '600085.XSHG', '600089.XSHG', '600100.XSHG', '600104.XSHG', '600109.XSHG', '600111.XSHG', '600115.XSHG', '600118.XSHG', '600153.XSHG', '600157.XSHG', '600170.XSHG', '600176.XSHG', '600177.XSHG', '600188.XSHG', '600196.XSHG', '600208.XSHG', '600219.XSHG', '600221.XSHG', '600233.XSHG', '600271.XSHG', '600276.XSHG', '600297.XSHG', '600309.XSHG', '600332.XSHG', '600339.XSHG', '600340.XSHG', '600346.XSHG', '600352.XSHG', '600362.XSHG', '600369.XSHG', '600372.XSHG', '600383.XSHG', '600390.XSHG', '600398.XSHG', '600406.XSHG', '600415.XSHG', '600436.XSHG', '600438.XSHG', '600482.XSHG', '600487.XSHG', '600489.XSHG', '600498.XSHG', '600516.XSHG', '600518.XSHG', '600519.XSHG', '600522.XSHG', '600535.XSHG', '600547.XSHG', '600549.XSHG', '600566.XSHG', '600570.XSHG', '600583.XSHG', '600585.XSHG', '600588.XSHG', '600606.XSHG', '600637.XSHG', '600660.XSHG', '600674.XSHG', '600688.XSHG', '600690.XSHG', '600703.XSHG', '600704.XSHG', '600705.XSHG', '600739.XSHG', '600741.XSHG', '600760.XSHG', '600795.XSHG', '600809.XSHG', '600816.XSHG', '600837.XSHG', '600867.XSHG', '600886.XSHG', '600887.XSHG', '600893.XSHG', '600900.XSHG', '600909.XSHG', '600919.XSHG', '600926.XSHG', '600958.XSHG', '600977.XSHG', '600998.XSHG', '600999.XSHG', '601006.XSHG', '601009.XSHG', '601012.XSHG', '601018.XSHG', '601021.XSHG', '601066.XSHG', '601088.XSHG', '601108.XSHG', '601111.XSHG', '601117.XSHG', '601138.XSHG', '601155.XSHG', '601166.XSHG', '601169.XSHG', '601186.XSHG', '601198.XSHG', '601211.XSHG', '601212.XSHG', '601216.XSHG', '601225.XSHG', '601228.XSHG', '601229.XSHG', '601238.XSHG', '601288.XSHG', '601318.XSHG', '601328.XSHG', '601333.XSHG', '601336.XSHG', '601360.XSHG', '601377.XSHG', '601390.XSHG', '601398.XSHG', '601555.XSHG', '601600.XSHG', '601601.XSHG', '601607.XSHG', '601611.XSHG', '601618.XSHG', '601628.XSHG', '601633.XSHG', '601668.XSHG', '601669.XSHG', '601688.XSHG', '601727.XSHG', '601766.XSHG', '601788.XSHG', '601800.XSHG', '601808.XSHG', '601818.XSHG', '601828.XSHG', '601838.XSHG', '601857.XSHG', '601877.XSHG', '601878.XSHG', '601881.XSHG', '601888.XSHG', '601898.XSHG', '601899.XSHG', '601901.XSHG', '601919.XSHG', '601933.XSHG', '601939.XSHG', '601985.XSHG', '601988.XSHG', '601989.XSHG', '601991.XSHG', '601992.XSHG', '601997.XSHG', '601998.XSHG', '603156.XSHG', '603160.XSHG', '603259.XSHG', '603260.XSHG', '603288.XSHG', '603799.XSHG', '603833.XSHG', '603858.XSHG', '603986.XSHG', '603993.XSHG']
hs300 = [convertCode(i) for i in hs300]
#hs300 = hs300_jq
zz500 = ['000006.XSHE', '000008.XSHE', '000009.XSHE', '000012.XSHE', '000021.XSHE', '000025.XSHE', '000027.XSHE', '000028.XSHE', '000031.XSHE', '000039.XSHE', '000049.XSHE', '000060.XSHE', '000061.XSHE', '000062.XSHE', '000066.XSHE', '000078.XSHE', '000089.XSHE', '000090.XSHE', '000156.XSHE', '000158.XSHE', '000400.XSHE', '000401.XSHE', '000418.XSHE', '000426.XSHE', '000488.XSHE', '000501.XSHE', '000513.XSHE', '000519.XSHE', '000528.XSHE', '000536.XSHE', '000537.XSHE', '000541.XSHE', '000543.XSHE', '000547.XSHE', '000552.XSHE', '000559.XSHE', '000563.XSHE', '000564.XSHE', '000581.XSHE', '000587.XSHE', '000596.XSHE', '000598.XSHE', '000600.XSHE', '000612.XSHE', '000623.XSHE', '000636.XSHE', '000656.XSHE', '000667.XSHE', '000681.XSHE', '000685.XSHE', '000686.XSHE', '000690.XSHE', '000712.XSHE', '000717.XSHE', '000718.XSHE', '000723.XSHE', '000727.XSHE', '000729.XSHE', '000732.XSHE', '000738.XSHE', '000750.XSHE', '000758.XSHE', '000761.XSHE', '000766.XSHE', '000778.XSHE', '000807.XSHE', '000813.XSHE', '000829.XSHE', '000830.XSHE', '000848.XSHE', '000860.XSHE', '000877.XSHE', '000878.XSHE', '000887.XSHE', '000926.XSHE', '000930.XSHE', '000932.XSHE', '000937.XSHE', '000960.XSHE', '000969.XSHE', '000970.XSHE', '000975.XSHE', '000980.XSHE', '000987.XSHE', '000988.XSHE', '000990.XSHE', '000997.XSHE', '000998.XSHE', '000999.XSHE', '002002.XSHE', '002004.XSHE', '002013.XSHE', '002019.XSHE', '002028.XSHE', '002030.XSHE', '002038.XSHE', '002041.XSHE', '002048.XSHE', '002049.XSHE', '002051.XSHE', '002056.XSHE', '002064.XSHE', '002074.XSHE', '002078.XSHE', '002092.XSHE', '002093.XSHE', '002110.XSHE', '002118.XSHE', '002127.XSHE', '002128.XSHE', '002129.XSHE', '002131.XSHE', '002147.XSHE', '002152.XSHE', '002155.XSHE', '002174.XSHE', '002176.XSHE', '002183.XSHE', '002191.XSHE', '002195.XSHE', '002212.XSHE', '002221.XSHE', '002223.XSHE', '002233.XSHE', '002242.XSHE', '002244.XSHE', '002249.XSHE', '002250.XSHE', '002251.XSHE', '002254.XSHE', '002266.XSHE', '002268.XSHE', '002273.XSHE', '002276.XSHE', '002277.XSHE', '002280.XSHE', '002281.XSHE', '002285.XSHE', '002299.XSHE', '002302.XSHE', '002308.XSHE', '002317.XSHE', '002332.XSHE', '002340.XSHE', '002344.XSHE', '002345.XSHE', '002353.XSHE', '002354.XSHE', '002358.XSHE', '002359.XSHE', '002366.XSHE', '002368.XSHE', '002371.XSHE', '002372.XSHE', '002373.XSHE', '002375.XSHE', '002384.XSHE', '002385.XSHE', '002390.XSHE', '002399.XSHE', '002400.XSHE', '002407.XSHE', '002408.XSHE', '002410.XSHE', '002414.XSHE', '002416.XSHE', '002424.XSHE', '002426.XSHE', '002431.XSHE', '002434.XSHE', '002437.XSHE', '002439.XSHE', '002440.XSHE', '002444.XSHE', '002463.XSHE', '002465.XSHE', '002470.XSHE', '002477.XSHE', '002482.XSHE', '002489.XSHE', '002491.XSHE', '002500.XSHE', '002503.XSHE', '002505.XSHE', '002506.XSHE', '002507.XSHE', '002509.XSHE', '002512.XSHE', '002517.XSHE', '002544.XSHE', '002563.XSHE', '002573.XSHE', '002583.XSHE', '002588.XSHE', '002589.XSHE', '002603.XSHE', '002635.XSHE', '002640.XSHE', '002642.XSHE', '002663.XSHE', '002665.XSHE', '002670.XSHE', '002672.XSHE', '002681.XSHE', '002690.XSHE', '002699.XSHE', '002701.XSHE', '002707.XSHE', '002709.XSHE', '002745.XSHE', '002807.XSHE', '002815.XSHE', '002818.XSHE', '002831.XSHE', '002839.XSHE', '002916.XSHE', '002920.XSHE', '300001.XSHE', '300002.XSHE', '300010.XSHE', '300026.XSHE', '300027.XSHE', '300055.XSHE', '300058.XSHE', '300088.XSHE', '300113.XSHE', '300115.XSHE', '300133.XSHE', '300134.XSHE', '300146.XSHE', '300156.XSHE', '300159.XSHE', '300166.XSHE', '300168.XSHE', '300182.XSHE', '300197.XSHE', '300199.XSHE', '300202.XSHE', '300244.XSHE', '300253.XSHE', '300257.XSHE', '300266.XSHE', '300274.XSHE', '300287.XSHE', '300291.XSHE', '300297.XSHE', '300308.XSHE', '300315.XSHE', '300316.XSHE', '300324.XSHE', '300347.XSHE', '300376.XSHE', '300383.XSHE', '300413.XSHE', '300418.XSHE', '300450.XSHE', '300459.XSHE', '600006.XSHG', '600008.XSHG', '600017.XSHG', '600021.XSHG', '600022.XSHG', '600026.XSHG', '600037.XSHG', '600039.XSHG', '600053.XSHG', '600056.XSHG', '600058.XSHG', '600060.XSHG', '600062.XSHG', '600064.XSHG', '600073.XSHG', '600079.XSHG', '600086.XSHG', '600094.XSHG', '600098.XSHG', '600120.XSHG', '600122.XSHG', '600125.XSHG', '600126.XSHG', '600138.XSHG', '600141.XSHG', '600143.XSHG', '600151.XSHG', '600155.XSHG', '600158.XSHG', '600160.XSHG', '600161.XSHG', '600166.XSHG', '600167.XSHG', '600169.XSHG', '600171.XSHG', '600179.XSHG', '600183.XSHG', '600184.XSHG', '600195.XSHG', '600201.XSHG', '600216.XSHG', '600240.XSHG', '600256.XSHG', '600258.XSHG', '600259.XSHG', '600260.XSHG', '600266.XSHG', '600267.XSHG', '600270.XSHG', '600277.XSHG', '600280.XSHG', '600282.XSHG', '600291.XSHG', '600298.XSHG', '600307.XSHG', '600312.XSHG', '600315.XSHG', '600316.XSHG', '600325.XSHG', '600329.XSHG', '600335.XSHG', '600338.XSHG', '600348.XSHG', '600350.XSHG', '600366.XSHG', '600373.XSHG', '600376.XSHG', '600380.XSHG', '600388.XSHG', '600392.XSHG', '600393.XSHG', '600409.XSHG', '600410.XSHG', '600416.XSHG', '600418.XSHG', '600426.XSHG', '600428.XSHG', '600435.XSHG', '600458.XSHG', '600460.XSHG', '600466.XSHG', '600478.XSHG', '600499.XSHG', '600500.XSHG', '600503.XSHG', '600507.XSHG', '600511.XSHG', '600525.XSHG', '600528.XSHG', '600536.XSHG', '600545.XSHG', '600557.XSHG', '600563.XSHG', '600565.XSHG', '600567.XSHG', '600572.XSHG', '600575.XSHG', '600580.XSHG', '600582.XSHG', '600584.XSHG', '600594.XSHG', '600597.XSHG', '600598.XSHG', '600600.XSHG', '600611.XSHG', '600614.XSHG', '600618.XSHG', '600623.XSHG', '600633.XSHG', '600639.XSHG', '600640.XSHG', '600642.XSHG', '600643.XSHG', '600645.XSHG', '600648.XSHG', '600649.XSHG', '600655.XSHG', '600657.XSHG', '600664.XSHG', '600673.XSHG', '600687.XSHG', '600694.XSHG', '600699.XSHG', '600717.XSHG', '600718.XSHG', '600729.XSHG', '600737.XSHG', '600743.XSHG', '600748.XSHG', '600750.XSHG', '600751.XSHG', '600754.XSHG', '600755.XSHG', '600757.XSHG', '600759.XSHG', '600765.XSHG', '600770.XSHG', '600773.XSHG', '600777.XSHG', '600779.XSHG', '600782.XSHG', '600787.XSHG', '600801.XSHG', '600804.XSHG', '600808.XSHG', '600811.XSHG', '600820.XSHG', '600823.XSHG', '600827.XSHG', '600835.XSHG', '600839.XSHG', '600848.XSHG', '600859.XSHG', '600862.XSHG', '600863.XSHG', '600869.XSHG', '600872.XSHG', '600874.XSHG', '600875.XSHG', '600879.XSHG', '600881.XSHG', '600884.XSHG', '600885.XSHG', '600895.XSHG', '600901.XSHG', '600908.XSHG', '600917.XSHG', '600939.XSHG', '600959.XSHG', '600967.XSHG', '600970.XSHG', '600971.XSHG', '600978.XSHG', '600993.XSHG', '600996.XSHG', '601000.XSHG', '601001.XSHG', '601003.XSHG', '601005.XSHG', '601016.XSHG', '601019.XSHG', '601020.XSHG', '601098.XSHG', '601100.XSHG', '601106.XSHG', '601127.XSHG', '601128.XSHG', '601168.XSHG', '601179.XSHG', '601200.XSHG', '601231.XSHG', '601311.XSHG', '601326.XSHG', '601608.XSHG', '601678.XSHG', '601689.XSHG', '601717.XSHG', '601718.XSHG', '601777.XSHG', '601801.XSHG', '601811.XSHG', '601866.XSHG', '601869.XSHG', '601872.XSHG', '601880.XSHG', '601928.XSHG', '601958.XSHG', '601966.XSHG', '601969.XSHG', '601990.XSHG', '603000.XSHG', '603025.XSHG', '603056.XSHG', '603077.XSHG', '603169.XSHG', '603198.XSHG', '603225.XSHG', '603228.XSHG', '603233.XSHG', '603328.XSHG', '603355.XSHG', '603369.XSHG', '603377.XSHG', '603444.XSHG', '603486.XSHG', '603515.XSHG', '603556.XSHG', '603568.XSHG', '603569.XSHG', '603650.XSHG', '603658.XSHG', '603659.XSHG', '603712.XSHG', '603766.XSHG', '603806.XSHG', '603816.XSHG', '603866.XSHG', '603868.XSHG', '603877.XSHG', '603883.XSHG', '603885.XSHG', '603888.XSHG', '603899.XSHG']
zz500 = [convertCode(i) for i in zz500]
stocklist = hs300 + zz500
#stocklist = [convertCode(i) for i in stocklist]

print(len(stocklist))


for root, dirs, files in os.walk(rootdir + "hs300"):
    for filename in files:
        os.remove(rootdir + "hs300/" + filename)

for root, dirs, files in os.walk(rootdir + "live2"):
    for filename in files:
        os.remove(rootdir + "live2/" + filename)

for root, dirs, files in os.walk(rootdir + "houfu2"):
    for filename in files:
        os.remove(rootdir + "houfu2/" + filename)

count = 0              
for code in hs300:
    count+=1
    filename = getMarketCode(code)
    print("Times:" + str(count))
    mycopyfile(rootdir + "live/" + filename,rootdir + "hs300/" + filename)


count = 0
for code in stocklist:
    count+=1
    filename = getMarketCode(code)
    print("Times:" + str(count))
    mycopyfile(rootdir + "live/" + filename,rootdir + "live2/" + filename)
    mycopyfile(rootdir + "houfu/" + filename,rootdir + "houfu2/" + filename)

print("Update Done")    